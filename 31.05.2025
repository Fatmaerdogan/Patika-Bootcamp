--TABLO BIRLESTIRILMESI

select top 5 * from ORDERS o
inner join ORDERDETAILS od on o.ID=od.ORDERID
inner join ITEMS ITM ON ITM.ID=od.ITEMID
inner join USERS U ON o.USERID=U.ID
inner join ADDRESS AD ON AD.ID=o.ADDRESSID

select top 5 * from USERS o
right join ADDRESS AD ON AD.USERID=o.ID




SELECT 
	O.USERID
	,O.DATE_
	,O.TOTALPRICE
	,ITM.ITEMNAME
	,ITM.CATEGORY1
	,U.NAMESURNAME
	--,T.TOWN
FROM ORDERS O
INNER JOIN ORDERDETAILS OD ON O.ID=OD.ORDERID
INNER JOIN ITEMS ITM ON ITM.ID=OD.ITEMID
INNER JOIN USERS U ON U.ID=O.USERID
INNER JOIN ADDRESS AD ON AD.ID=O.ADDRESSID


---------------------------------------SORGULAR
SELECT * FROM [dbo].[ADDRESS]
---EN FAZLA ALIŞVERİŞ HANGİ KATEGORİDE (CATEGORY1) YAPILMIŞTIR

SELECT 
  CATEGORY1, 
  SUM(CAST(LINETOTAL AS FLOAT)) AS TOTALCIRO
FROM ORDERS O
INNER JOIN ORDERDETAILS OD ON O.ID = OD.ORDERID
INNER JOIN ITEMS IT ON IT.ID = OD.ITEMID
GROUP BY CATEGORY1 
ORDER BY 2 DESC;

---EN FAZLA ALIŞİVERİŞ HANGİ MARKADA YAPILMIŞ

SELECT BRAND,SUM(LINETOTAL)MARKATOPLAMCIRO FROM ORDERS O
INNER JOIN ORDERDETAILS OD ON O.ID=OD.ORDERID
INNER JOIN ITEMS IT ON IT.ID=OD.ITEMID
GROUP BY BRAND ORDER BY 2 DESC


-----EV ANA KATEGORİSİNDE, KİTAP-DERGİ-KIRTASİYE UST KAT, KITAP ALT EN FAZLA SATIŞ YAPAN KİTAPLAR
SELECT IT.ITEMNAME,SUM(AMOUNT)KITAPSATISADET FROM ORDERS O
INNER JOIN ORDERDETAILS OD ON O.ID=OD.ORDERID
INNER JOIN ITEMS IT ON IT.ID=OD.ITEMID
WHERE CATEGORY1='EV' AND CATEGORY2='KITAP-DERGI-KIRTASIYE' AND CATEGORY3='KITAP'
GROUP BY IT.ITEMNAME ORDER BY 2 DESC


-------OYUNCAK KATEGORİSİNDE ÜRÜNLERİN ORTALAMA FİYATI NEDİR ?

SELECT 
CATEGORY1,
SUM(LINETOTAL) AS CIRO,
SUM(AMOUNT) AS ADET, 
SUM(LINETOTAL)/SUM(AMOUNT) AS ORTFIYAT
FROM ORDERS O
INNER JOIN ORDERDETAILS OD ON O.ID=OD.ORDERID
INNER JOIN ITEMS IT ON IT.ID=OD.ITEMID
WHERE CATEGORY1='OYUNCAK'
GROUP BY CATEGORY1

------KOZMETIKTE ŞAMPUAN KATEGORİSİNDE EN DÜŞÜK BİRİM FİYATY HANGİ MARKANIN
SELECT DISTINCT BRAND,CATEGORY3 FROM ITEMS WHERE CATEGORY1='KOZMETIK'

SELECT DISTINCT BRAND,CATEGORY3 FROM ITEMS WHERE CATEGORY1='KOZMETIK'
AND CATEGORY3 LIKE '%SAMPU%' ORDER BY 1

SELECT DISTINCT BRAND,MIN(OD.UNITPRICE)AS ORTBIRIMFIYAT FROM ORDERS O
INNER JOIN ORDERDETAILS OD ON O.ID=OD.ORDERID
INNER JOIN ITEMS IT ON IT.ID=OD.ITEMID
WHERE CATEGORY1='KOZMETIK' AND CATEGORY3 LIKE '%SAMPU%'
GROUP BY BRAND ORDER BY 2 DESC


------------HANGİ YAŞ GRUPLARI DAHA FAZLA ALIŞVERİŞ YAPMIŞ? (ADET)

SELECT ITEMNAME,SUM(AMOUNT)TOPLAMADET FROM ORDERS O
INNER JOIN ORDERDETAILS OD ON O.ID=OD.ORDERID
INNER JOIN USERS U ON U.ID=O.USERID
INNER JOIN ITEMS IT ON IT.ID=OD.ITEMID
WHERE AGE=85 AND CATEGORY4='KIRTASIYE GERECLERI'
GROUP BY ITEMNAME
ORDER BY 2 DESC


---------------------KADINLAR NELER ALMIŞ ?

SELECT CATEGORY1,CATEGORY2,CATEGORY3,CATEGORY4,SUM(LINETOTAL)LINETOTAL FROM ORDERS O
INNER JOIN ORDERDETAILS OD ON O.ID=OD.ORDERID
INNER JOIN USERS U ON U.ID=O.USERID
INNER JOIN ITEMS IT ON IT.ID=OD.ITEMID
WHERE GENDER='K'
GROUP BY CATEGORY1,CATEGORY2,CATEGORY3,CATEGORY4
ORDER BY 5 DESC

SELECT ITEMNAME,SUM(LINETOTAL)LINETOTAL FROM ORDERS O
INNER JOIN ORDERDETAILS OD ON O.ID=OD.ORDERID
INNER JOIN USERS U ON U.ID=O.USERID
INNER JOIN ITEMS IT ON IT.ID=OD.ITEMID
WHERE GENDER='K' AND CATEGORY4='BEBE OYUNCAK'
GROUP BY ITEMNAME
ORDER BY 2 DESC


--------18-35 YAŞ GRUBU NELER ALMIŞ

SELECT CATEGORY2,CATEGORY3,CATEGORY4,SUM(LINETOTAL)LINETOTAL FROM ORDERS O
INNER JOIN ORDERDETAILS OD ON O.ID=OD.ORDERID
INNER JOIN USERS U ON U.ID=O.USERID
INNER JOIN ITEMS IT ON IT.ID=OD.ITEMID
WHERE AGE BETWEEN 18 AND 35 AND CATEGORY1='GIDA'
GROUP BY CATEGORY2,CATEGORY3,CATEGORY4
ORDER BY 3,4 DESC
